<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>データ入力</title>
  <style>
    body { font-family: system-ui, sans-serif; padding: 16px; text-align: center; background-color: #f9f9f9; }
    h1 { color: #333; }
    .container { max-width: 400px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .field { margin-bottom: 20px; text-align: left; }
    label { display: block; margin-bottom: 8px; font-weight: bold; }
    
    .btn-group { display: flex; gap: 8px; flex-wrap: wrap; }
    button.selectable {
      flex: 1;
      padding: 10px;
      border-radius: 4px;
      border: 1px solid #ccc;
      background: #f5f5f5;
      cursor: pointer;
      transition: background 0.3s;
    }
    button.selectable:hover { background: #e0e0e0; }
    button.selectable.active {
      background: #33DD99;
      color: #fff;
      border-color: #33DD99;
    }
    
    input[type="date"], input[type="number"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    
    .submit-btn {
      width: 100%;
      padding: 12px;
      background-color: #ff69b4;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      cursor: pointer;
      font-weight: bold;
    }
    .submit-btn:hover { background-color: #ff1493; }

    /* Flash Message Styles */
    .alert { padding: 10px; margin-bottom: 15px; border-radius: 4px; text-align: left; }
    .alert-success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .alert-danger { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .alert-warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba; }

    a { display: inline-block; margin-top: 20px; color: #666; text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>

<div class="container">
  <h1>購入データ入力</h1>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <form action="{{ url_for('insert') }}" method="POST" id="insert-form">

    <div class="field">
      <label>日付（yyyy/mm/dd）：</label>
      <input type="date" id="date-input" name="date" required>
    </div>

    <div class="field">
      <label>購入時間帯：</label>
      <div class="btn-group" id="time-group">
        <button type="button" class="selectable" data-value="朝">朝</button>
        <button type="button" class="selectable" data-value="昼">昼</button>
        <button type="button" class="selectable" data-value="晩">晩</button>
      </div>
      <input type="hidden" name="time_period" id="hidden-time" required>
    </div>

    <div class="field">
      <label>購入カテゴリー：</label>
      <div class="btn-group" id="category-group">
        <button type="button" class="selectable" data-value="ドリンク">ドリンク</button>
        <button type="button" class="selectable" data-value="スナック">スナック</button>
        <button type="button" class="selectable" data-value="フード">フード</button>
        <button type="button" class="selectable" data-value="その他">その他</button>
      </div>
      <input type="hidden" name="category" id="hidden-category" required>
    </div>

    <div class="field">
      <label>金額（円）：</label>
      <input type="number" name="amount" id="amount-input" min="0" step="1" placeholder="0" required>
    </div>

    <button type="submit" class="submit-btn">データを登録</button>

  </form>

  <a href="{{ url_for('index') }}">ホームに戻る</a>
</div>

<script>
  // 日付の初期値を「今日」に設定
  (function setToday() {
    const input = document.getElementById('date-input');
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = ('0' + (today.getMonth() + 1)).slice(-2);
    const dd = ('0' + today.getDate()).slice(-2);
    input.value = `${yyyy}-${mm}-${dd}`;
  })();

  // 選択ロジック（ボタンクリック -> 隠しinputへの値セット）
  function setupSingleSelect(groupId, hiddenInputId) {
    const group = document.getElementById(groupId);
    const hiddenInput = document.getElementById(hiddenInputId);
    
    group.addEventListener('click', (e) => {
      if (!e.target.classList.contains('selectable')) return;
      
      // 見た目の切り替え
      [...group.querySelectorAll('.selectable')]
        .forEach(btn => btn.classList.remove('active'));
      e.target.classList.add('active');

      // 値を隠しフィールドにセット (これでサーバーに送信されます)
      hiddenInput.value = e.target.dataset.value;
    });
  }

  // 時間帯とカテゴリの設定
  setupSingleSelect('time-group', 'hidden-time');
  setupSingleSelect('category-group', 'hidden-category');

  // フォーム送信前のバリデーション（念の為）
  document.getElementById('insert-form').addEventListener('submit', function(e) {
    const time = document.getElementById('hidden-time').value;
    const category = document.getElementById('hidden-category').value;
    
    if (!time || !category) {
      e.preventDefault(); // 送信キャンセル
      alert('時間帯とカテゴリーを選択してください。');
    }
  });
</script>

</body>
</html>