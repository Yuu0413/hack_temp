{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card-custom">
            <h1 class="h3">無駄遣い記録</h1>
            <form action="{{ url_for('insert') }}" method="POST" id="insert-form">
                <div class="mb-3">
                    <label class="form-label fw-bold">日付</label>
                    <input type="date" name="date" id="date-input" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-bold">時間帯</label>
                    <div class="selectable-group" id="time-group">
                        <button type="button" class="selectable-btn" data-value="朝">朝</button>
                        <button type="button" class="selectable-btn" data-value="昼">昼</button>
                        <button type="button" class="selectable-btn" data-value="晩">晩</button>
                    </div>
                    <input type="hidden" name="time_period" id="hidden-time" required>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-bold">カテゴリー</label>
                    <div class="selectable-group" id="category-group">
                        <button type="button" class="selectable-btn" data-value="ドリンク">ドリンク</button>
                        <button type="button" class="selectable-btn" data-value="スナック">スナック</button>
                        <button type="button" class="selectable-btn" data-value="フード">フード</button>
                        <button type="button" class="selectable-btn" data-value="その他">その他</button>
                    </div>
                    <input type="hidden" name="category" id="hidden-category" required>
                </div>

                <div class="mb-4">
                    <label class="form-label fw-bold">金額（円）</label>
                    <input type="number" name="amount" class="form-control" placeholder="150" required>
                </div>

                <button type="submit" class="submit-btn mb-3 shadow-sm">登録する</button>
                
                <div class="text-center">
                    <a href="{{ url_for('index') }}" class="btn btn-link text-decoration-none fw-bold" style="color: var(--text-color);">
                        &laquo; ホームに戻る
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // ★修正：ページ読み込み時に常に当日の日付を設定
    window.onload = function() {
        const dateInput = document.getElementById('date-input');
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        dateInput.value = `${year}-${month}-${day}`;
    };

    function setupSelect(groupId, hiddenId) {
        const group = document.getElementById(groupId);
        const hidden = document.getElementById(hiddenId);
        group.addEventListener('click', (e) => {
            if (!e.target.classList.contains('selectable-btn')) return;
            group.querySelectorAll('.selectable-btn').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            hidden.value = e.target.dataset.value;
        });
    }
    setupSelect('time-group', 'hidden-time');
    setupSelect('category-group', 'hidden-category');
</script>
{% endblock %}